<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Timeline Exceendance</title>

  <link rel="stylesheet" href="index.css" />
  <link rel="stylesheet" href="widget.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha256-KM512VNnjElC30ehFwehXjx1YCHPiQkOPmqnrWtpccM=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js" integrity="sha256-N4u5BjTLNwmGul6RgLoESPNqDFVUibVuOYhP4gJgrew=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js" integrity="sha256-8E6QUcFg1KTnpEU8TFGhpTGHw5fJqB9vCms3OhAYLqw=" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/@ungap/url-search-params"></script>

  <script src="stations.js"></script>
  <script src="widget.js"></script>
</head>
<body>
  <h4 class="stations-select">
    <span id="stations-val"></span>
    <select id="stations"></select>
  </h4>
  <div class="widget-container">
    <div id="widget"></div>
  </div>
</body>
<script>
  $(document).ready(function() {
    var urlParams = new URLSearchParams(window.location.search);

    var id = urlParams.get('station') || STATIONS[0].id;
    var station = STATIONS.find(s => s.id === id);

    $.each(STATIONS, function (i, item) {
      $('#stations')
        .append($('<option>', {
          value: item.id,
          text : item.name
        }));
    });

    $('#stations').val(station.id);
    $('#stations-val').text(station.name);

    $("#widget").item({
      station: $('#stations').val(), // GHCN-D Station id (required)
      variable: 'precipitation', // Valid values: 'precipitation', 'tmax', 'tmin', 'tavg'
      threshold: 1.0,
      thresholdOperator: '>', // Valid values: '==', '>=', '>', '<=', '<'
      thresholdFilter: '', // Transformations/Filters to support additional units. Valid Values: 'KtoC','CtoK','FtoC','CtoF','InchToCM','CMtoInch'
      thresholdFunction: undefined, //Pass in a custom function: function(this, values){ return _.sum(values) > v2; }
      window: 1, // Rolling window size in days.
      dailyValueValidator: undefined, // Pass in a custom validator predicate function(value, date){return date.slice(0, 4) > 1960 && value > 5 }
      yearValidator: undefined, // Similar to dailyValueValidator
      dataAPIEndpoint: "https://data.rcc-acis.org/",
      barColor: '#307bda' // Color for bars.
    });

    $('#stations').change(() => {
      var station = STATIONS.find(s => s.id === $('#stations').val());

      $('#stations-val').text(station.name);

      $("#widget").item('option', 'station', $('#stations').val()).item('update');
    });
  })
</script>

</html>